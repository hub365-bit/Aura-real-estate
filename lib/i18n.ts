import { I18n } from 'i18n-js';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

const translations = {
  en: {
    common: {
      loading: 'Loading...',
      error: 'Error',
      success: 'Success',
      cancel: 'Cancel',
      save: 'Save',
      delete: 'Delete',
      edit: 'Edit',
      back: 'Back',
      next: 'Next',
      done: 'Done',
      search: 'Search',
      filter: 'Filter',
      sort: 'Sort',
      confirm: 'Confirm',
      yes: 'Yes',
      no: 'No',
      ok: 'OK',
    },
    tabs: {
      properties: 'Properties',
      services: 'Services',
      bookings: 'Bookings',
      feed: 'Feed',
      profile: 'Profile',
      map: 'Map',
    },
    auth: {
      login: 'Log In',
      signup: 'Sign Up',
      logout: 'Log Out',
      email: 'Email',
      password: 'Password',
      phone: 'Phone Number',
      verifyOTP: 'Verify OTP',
      enterOTP: 'Enter the OTP sent to your phone',
      resendOTP: 'Resend OTP',
      createAccount: 'Create Account',
      forgotPassword: 'Forgot Password?',
      dontHaveAccount: "Don't have an account?",
      alreadyHaveAccount: 'Already have an account?',
    },
    properties: {
      title: 'Properties',
      forRent: 'For Rent',
      forSale: 'For Sale',
      bedrooms: 'Bedrooms',
      bathrooms: 'Bathrooms',
      sqft: 'sq ft',
      viewDetails: 'View Details',
      bookNow: 'Book Now',
      contactAgent: 'Contact Agent',
      description: 'Description',
      features: 'Features',
      location: 'Location',
      getDirections: 'Get Directions',
      addToFavorites: 'Add to Favorites',
      removeFromFavorites: 'Remove from Favorites',
      boosted: 'Boosted',
      verified: 'Verified',
    },
    bookings: {
      title: 'My Bookings',
      upcoming: 'Upcoming',
      completed: 'Completed',
      cancelled: 'Cancelled',
      checkIn: 'Check-in',
      checkOut: 'Check-out',
      bookingConfirmed: 'Booking Confirmed',
      bookingID: 'Booking ID',
      scanQR: 'Scan QR Code at entrance',
      viewDetails: 'View Details',
      cancelBooking: 'Cancel Booking',
      noBookings: 'No bookings yet',
    },
    services: {
      title: 'Services',
      categories: 'Categories',
      plumbing: 'Plumbing',
      electrical: 'Electrical',
      cleaning: 'Cleaning',
      repairs: 'Repairs',
      delivery: 'Delivery',
      events: 'Events',
      bookService: 'Book Service',
      viewProvider: 'View Provider',
      rating: 'Rating',
      reviews: 'Reviews',
      availability: 'Availability',
      workingHours: 'Working Hours',
    },
    tickets: {
      title: 'Support Tickets',
      create: 'Create Ticket',
      type: 'Ticket Type',
      repair: 'Repair',
      vacate: 'Vacate',
      complaint: 'Complaint',
      other: 'Other',
      description: 'Description',
      attachFiles: 'Attach Files',
      submit: 'Submit Ticket',
      status: 'Status',
      open: 'Open',
      claimed: 'Claimed',
      inProgress: 'In Progress',
      resolved: 'Resolved',
      closed: 'Closed',
      noTickets: 'No tickets',
    },
    rewards: {
      title: 'Rewards',
      yourPoints: 'Your Points',
      leaderboard: 'Leaderboard',
      earnPoints: 'Earn Points',
      redeemPoints: 'Redeem Points',
      pointsHistory: 'Points History',
      earnedFor: 'Earned for',
      commenting: 'Commenting',
      rating: 'Rating',
      booking: 'Booking',
      following: 'Following businesses',
      review: 'Posting verified reviews',
    },
    profile: {
      title: 'Profile',
      editProfile: 'Edit Profile',
      settings: 'Settings',
      notifications: 'Notifications',
      language: 'Language',
      theme: 'Theme',
      subscriptionPlan: 'Subscription Plan',
      documentVerification: 'Document Verification',
      help: 'Help & Support',
      about: 'About',
      termsOfService: 'Terms of Service',
      privacyPolicy: 'Privacy Policy',
    },
    subscription: {
      title: 'Subscription Plans',
      free: 'Free',
      weekly: 'Weekly',
      monthly: 'Monthly',
      yearly: 'Yearly',
      currentPlan: 'Current Plan',
      upgrade: 'Upgrade',
      choosePlan: 'Choose Plan',
      features: 'Features',
      unlimitedListings: 'Unlimited Listings',
      prioritySupport: 'Priority Support',
      analyticsAccess: 'Analytics Access',
      boostListings: 'Boost Listings',
    },
    notifications: {
      title: 'Notifications',
      bookingConfirmed: 'Booking Confirmed',
      paymentReminder: 'Payment Reminder',
      ticketUpdate: 'Ticket Update',
      rewardEarned: 'Reward Earned',
      newMessage: 'New Message',
      subscriptionExpiring: 'Subscription Expiring',
    },
    messages: {
      title: 'Messages',
      newMessage: 'New Message',
      conversation: 'Conversation',
      typeMessage: 'Type a message...',
      send: 'Send',
      noMessages: 'No messages',
    },
  },
  sw: {
    common: {
      loading: 'Inapakia...',
      error: 'Kosa',
      success: 'Mafanikio',
      cancel: 'Ghairi',
      save: 'Hifadhi',
      delete: 'Futa',
      edit: 'Hariri',
      back: 'Rudi',
      next: 'Ifuatayo',
      done: 'Imekamilika',
      search: 'Tafuta',
      filter: 'Chuja',
      sort: 'Panga',
      confirm: 'Thibitisha',
      yes: 'Ndiyo',
      no: 'Hapana',
      ok: 'Sawa',
    },
    tabs: {
      properties: 'Mali',
      services: 'Huduma',
      bookings: 'Uhifadhi',
      feed: 'Habari',
      profile: 'Wasifu',
      map: 'Ramani',
    },
    auth: {
      login: 'Ingia',
      signup: 'Jisajili',
      logout: 'Toka',
      email: 'Barua Pepe',
      password: 'Nenosiri',
      phone: 'Nambari ya Simu',
      verifyOTP: 'Thibitisha OTP',
      enterOTP: 'Weka OTP iliyotumwa kwa simu yako',
      resendOTP: 'Tuma OTP Tena',
      createAccount: 'Fungua Akaunti',
      forgotPassword: 'Umesahau Nenosiri?',
      dontHaveAccount: 'Huna akaunti?',
      alreadyHaveAccount: 'Tayari una akaunti?',
    },
    properties: {
      title: 'Mali',
      forRent: 'Kwa Kukodi',
      forSale: 'Kwa Kuuza',
      bedrooms: 'Vyumba vya Kulala',
      bathrooms: 'Bafu',
      sqft: 'futi za mraba',
      viewDetails: 'Angalia Maelezo',
      bookNow: 'Hifadhi Sasa',
      contactAgent: 'Wasiliana na Wakala',
      description: 'Maelezo',
      features: 'Vipengele',
      location: 'Eneo',
      getDirections: 'Pata Maelekezo',
      addToFavorites: 'Ongeza kwa Vipendwa',
      removeFromFavorites: 'Ondoa kutoka Vipendwa',
      boosted: 'Imeimarishwa',
      verified: 'Imethibitishwa',
    },
    bookings: {
      title: 'Uhifadhi Wangu',
      upcoming: 'Zijazo',
      completed: 'Zilizokamilika',
      cancelled: 'Zilizoghairiwa',
      checkIn: 'Ingia',
      checkOut: 'Toka',
      bookingConfirmed: 'Uhifadhi Umethibitishwa',
      bookingID: 'Kitambulisho cha Uhifadhi',
      scanQR: 'Changanua msimbo wa QR mlangoni',
      viewDetails: 'Angalia Maelezo',
      cancelBooking: 'Ghairi Uhifadhi',
      noBookings: 'Hakuna uhifadhi bado',
    },
    services: {
      title: 'Huduma',
      categories: 'Makundi',
      plumbing: 'Mabomba',
      electrical: 'Umeme',
      cleaning: 'Usafi',
      repairs: 'Ukarabati',
      delivery: 'Utoaji',
      events: 'Matukio',
      bookService: 'Hifadhi Huduma',
      viewProvider: 'Angalia Mtoaji',
      rating: 'Ukadiriaji',
      reviews: 'Mapitio',
      availability: 'Upatikanaji',
      workingHours: 'Masaa ya Kazi',
    },
    tickets: {
      title: 'Tiketi za Msaada',
      create: 'Unda Tiketi',
      type: 'Aina ya Tiketi',
      repair: 'Ukarabati',
      vacate: 'Hamia',
      complaint: 'Malalamiko',
      other: 'Nyingine',
      description: 'Maelezo',
      attachFiles: 'Ambatanisha Faili',
      submit: 'Wasilisha Tiketi',
      status: 'Hali',
      open: 'Wazi',
      claimed: 'Imedaiwa',
      inProgress: 'Inaendelea',
      resolved: 'Imetatuliwa',
      closed: 'Imefungwa',
      noTickets: 'Hakuna tiketi',
    },
    rewards: {
      title: 'Zawadi',
      yourPoints: 'Pointi Zako',
      leaderboard: 'Ubao wa Viongozi',
      earnPoints: 'Pata Pointi',
      redeemPoints: 'Komboa Pointi',
      pointsHistory: 'Historia ya Pointi',
      earnedFor: 'Umepata kwa',
      commenting: 'Kutoa Maoni',
      rating: 'Kukadiria',
      booking: 'Kuhifadhi',
      following: 'Kufuata Biashara',
      review: 'Kutoa Mapitio Yaliyothibitishwa',
    },
    profile: {
      title: 'Wasifu',
      editProfile: 'Hariri Wasifu',
      settings: 'Mipangilio',
      notifications: 'Arifa',
      language: 'Lugha',
      theme: 'Mandhari',
      subscriptionPlan: 'Mpango wa Usajili',
      documentVerification: 'Uthibitishaji wa Nyaraka',
      help: 'Msaada',
      about: 'Kuhusu',
      termsOfService: 'Masharti ya Huduma',
      privacyPolicy: 'Sera ya Faragha',
    },
    subscription: {
      title: 'Mipango ya Usajili',
      free: 'Bure',
      weekly: 'Kila Wiki',
      monthly: 'Kila Mwezi',
      yearly: 'Kila Mwaka',
      currentPlan: 'Mpango wa Sasa',
      upgrade: 'Boresha',
      choosePlan: 'Chagua Mpango',
      features: 'Vipengele',
      unlimitedListings: 'Orodha Zisizo na Kikomo',
      prioritySupport: 'Msaada wa Kipaumbele',
      analyticsAccess: 'Ufikiaji wa Takwimu',
      boostListings: 'Imarisha Orodha',
    },
    notifications: {
      title: 'Arifa',
      bookingConfirmed: 'Uhifadhi Umethibitishwa',
      paymentReminder: 'Kikumbusho cha Malipo',
      ticketUpdate: 'Sasisho la Tiketi',
      rewardEarned: 'Zawadi Imepokewa',
      newMessage: 'Ujumbe Mpya',
      subscriptionExpiring: 'Usajili Unakaribia Kuisha',
    },
    messages: {
      title: 'Ujumbe',
      newMessage: 'Ujumbe Mpya',
      conversation: 'Mazungumzo',
      typeMessage: 'Andika ujumbe...',
      send: 'Tuma',
      noMessages: 'Hakuna ujumbe',
    },
  },
  fr: {
    common: {
      loading: 'Chargement...',
      error: 'Erreur',
      success: 'Succès',
      cancel: 'Annuler',
      save: 'Enregistrer',
      delete: 'Supprimer',
      edit: 'Modifier',
      back: 'Retour',
      next: 'Suivant',
      done: 'Terminé',
      search: 'Rechercher',
      filter: 'Filtrer',
      sort: 'Trier',
      confirm: 'Confirmer',
      yes: 'Oui',
      no: 'Non',
      ok: 'OK',
    },
    tabs: {
      properties: 'Propriétés',
      services: 'Services',
      bookings: 'Réservations',
      feed: 'Actualités',
      profile: 'Profil',
      map: 'Carte',
    },
    auth: {
      login: 'Se connecter',
      signup: "S'inscrire",
      logout: 'Se déconnecter',
      email: 'Email',
      password: 'Mot de passe',
      phone: 'Numéro de téléphone',
      verifyOTP: 'Vérifier OTP',
      enterOTP: 'Entrez le OTP envoyé à votre téléphone',
      resendOTP: 'Renvoyer OTP',
      createAccount: 'Créer un compte',
      forgotPassword: 'Mot de passe oublié?',
      dontHaveAccount: "Vous n'avez pas de compte?",
      alreadyHaveAccount: 'Vous avez déjà un compte?',
    },
    properties: {
      title: 'Propriétés',
      forRent: 'À louer',
      forSale: 'À vendre',
      bedrooms: 'Chambres',
      bathrooms: 'Salles de bain',
      sqft: 'pieds carrés',
      viewDetails: 'Voir les détails',
      bookNow: 'Réserver maintenant',
      contactAgent: "Contacter l'agent",
      description: 'Description',
      features: 'Caractéristiques',
      location: 'Emplacement',
      getDirections: "Obtenir l'itinéraire",
      addToFavorites: 'Ajouter aux favoris',
      removeFromFavorites: 'Retirer des favoris',
      boosted: 'Boosté',
      verified: 'Vérifié',
    },
    bookings: {
      title: 'Mes réservations',
      upcoming: 'À venir',
      completed: 'Terminées',
      cancelled: 'Annulées',
      checkIn: 'Arrivée',
      checkOut: 'Départ',
      bookingConfirmed: 'Réservation confirmée',
      bookingID: 'ID de réservation',
      scanQR: "Scanner le code QR à l'entrée",
      viewDetails: 'Voir les détails',
      cancelBooking: 'Annuler la réservation',
      noBookings: 'Aucune réservation',
    },
    services: {
      title: 'Services',
      categories: 'Catégories',
      plumbing: 'Plomberie',
      electrical: 'Électricité',
      cleaning: 'Nettoyage',
      repairs: 'Réparations',
      delivery: 'Livraison',
      events: 'Événements',
      bookService: 'Réserver un service',
      viewProvider: 'Voir le fournisseur',
      rating: 'Note',
      reviews: 'Avis',
      availability: 'Disponibilité',
      workingHours: 'Heures de travail',
    },
    tickets: {
      title: 'Tickets de support',
      create: 'Créer un ticket',
      type: 'Type de ticket',
      repair: 'Réparation',
      vacate: 'Quitter',
      complaint: 'Plainte',
      other: 'Autre',
      description: 'Description',
      attachFiles: 'Joindre des fichiers',
      submit: 'Soumettre le ticket',
      status: 'Statut',
      open: 'Ouvert',
      claimed: 'Réclamé',
      inProgress: 'En cours',
      resolved: 'Résolu',
      closed: 'Fermé',
      noTickets: 'Aucun ticket',
    },
    rewards: {
      title: 'Récompenses',
      yourPoints: 'Vos points',
      leaderboard: 'Classement',
      earnPoints: 'Gagner des points',
      redeemPoints: 'Échanger des points',
      pointsHistory: 'Historique des points',
      earnedFor: 'Gagné pour',
      commenting: 'Commentaires',
      rating: 'Notation',
      booking: 'Réservation',
      following: 'Suivi des entreprises',
      review: 'Avis vérifiés',
    },
    profile: {
      title: 'Profil',
      editProfile: 'Modifier le profil',
      settings: 'Paramètres',
      notifications: 'Notifications',
      language: 'Langue',
      theme: 'Thème',
      subscriptionPlan: "Plan d'abonnement",
      documentVerification: 'Vérification des documents',
      help: 'Aide et support',
      about: 'À propos',
      termsOfService: 'Conditions de service',
      privacyPolicy: 'Politique de confidentialité',
    },
    subscription: {
      title: "Plans d'abonnement",
      free: 'Gratuit',
      weekly: 'Hebdomadaire',
      monthly: 'Mensuel',
      yearly: 'Annuel',
      currentPlan: 'Plan actuel',
      upgrade: 'Mettre à niveau',
      choosePlan: 'Choisir un plan',
      features: 'Fonctionnalités',
      unlimitedListings: 'Annonces illimitées',
      prioritySupport: 'Support prioritaire',
      analyticsAccess: 'Accès aux analyses',
      boostListings: 'Booster les annonces',
    },
    notifications: {
      title: 'Notifications',
      bookingConfirmed: 'Réservation confirmée',
      paymentReminder: 'Rappel de paiement',
      ticketUpdate: 'Mise à jour du ticket',
      rewardEarned: 'Récompense obtenue',
      newMessage: 'Nouveau message',
      subscriptionExpiring: "Abonnement expirant",
    },
    messages: {
      title: 'Messages',
      newMessage: 'Nouveau message',
      conversation: 'Conversation',
      typeMessage: 'Tapez un message...',
      send: 'Envoyer',
      noMessages: 'Aucun message',
    },
  },
  ar: {
    common: {
      loading: 'جار التحميل...',
      error: 'خطأ',
      success: 'نجاح',
      cancel: 'إلغاء',
      save: 'حفظ',
      delete: 'حذف',
      edit: 'تحرير',
      back: 'رجوع',
      next: 'التالي',
      done: 'تم',
      search: 'بحث',
      filter: 'تصفية',
      sort: 'ترتيب',
      confirm: 'تأكيد',
      yes: 'نعم',
      no: 'لا',
      ok: 'موافق',
    },
    tabs: {
      properties: 'العقارات',
      services: 'الخدمات',
      bookings: 'الحجوزات',
      feed: 'الأخبار',
      profile: 'الملف الشخصي',
      map: 'الخريطة',
    },
    auth: {
      login: 'تسجيل الدخول',
      signup: 'إنشاء حساب',
      logout: 'تسجيل الخروج',
      email: 'البريد الإلكتروني',
      password: 'كلمة المرور',
      phone: 'رقم الهاتف',
      verifyOTP: 'التحقق من OTP',
      enterOTP: 'أدخل OTP المرسل إلى هاتفك',
      resendOTP: 'إعادة إرسال OTP',
      createAccount: 'إنشاء حساب',
      forgotPassword: 'نسيت كلمة المرور؟',
      dontHaveAccount: 'ليس لديك حساب؟',
      alreadyHaveAccount: 'هل لديك حساب بالفعل؟',
    },
    properties: {
      title: 'العقارات',
      forRent: 'للإيجار',
      forSale: 'للبيع',
      bedrooms: 'غرف النوم',
      bathrooms: 'الحمامات',
      sqft: 'قدم مربع',
      viewDetails: 'عرض التفاصيل',
      bookNow: 'احجز الآن',
      contactAgent: 'اتصل بالوكيل',
      description: 'الوصف',
      features: 'المميزات',
      location: 'الموقع',
      getDirections: 'الحصول على الاتجاهات',
      addToFavorites: 'إضافة إلى المفضلة',
      removeFromFavorites: 'إزالة من المفضلة',
      boosted: 'معزز',
      verified: 'موثق',
    },
    bookings: {
      title: 'حجوزاتي',
      upcoming: 'القادمة',
      completed: 'المكتملة',
      cancelled: 'الملغاة',
      checkIn: 'تسجيل الوصول',
      checkOut: 'تسجيل المغادرة',
      bookingConfirmed: 'تم تأكيد الحجز',
      bookingID: 'معرف الحجز',
      scanQR: 'امسح رمز QR عند المدخل',
      viewDetails: 'عرض التفاصيل',
      cancelBooking: 'إلغاء الحجز',
      noBookings: 'لا توجد حجوزات بعد',
    },
    services: {
      title: 'الخدمات',
      categories: 'الفئات',
      plumbing: 'السباكة',
      electrical: 'الكهرباء',
      cleaning: 'التنظيف',
      repairs: 'الإصلاحات',
      delivery: 'التوصيل',
      events: 'الفعاليات',
      bookService: 'احجز الخدمة',
      viewProvider: 'عرض مقدم الخدمة',
      rating: 'التقييم',
      reviews: 'المراجعات',
      availability: 'التوفر',
      workingHours: 'ساعات العمل',
    },
    tickets: {
      title: 'تذاكر الدعم',
      create: 'إنشاء تذكرة',
      type: 'نوع التذكرة',
      repair: 'إصلاح',
      vacate: 'إخلاء',
      complaint: 'شكوى',
      other: 'أخرى',
      description: 'الوصف',
      attachFiles: 'إرفاق ملفات',
      submit: 'إرسال التذكرة',
      status: 'الحالة',
      open: 'مفتوحة',
      claimed: 'مطالب بها',
      inProgress: 'قيد التنفيذ',
      resolved: 'محلولة',
      closed: 'مغلقة',
      noTickets: 'لا توجد تذاكر',
    },
    rewards: {
      title: 'المكافآت',
      yourPoints: 'نقاطك',
      leaderboard: 'لوحة المتصدرين',
      earnPoints: 'اكسب النقاط',
      redeemPoints: 'استبدل النقاط',
      pointsHistory: 'تاريخ النقاط',
      earnedFor: 'مكتسب ل',
      commenting: 'التعليق',
      rating: 'التقييم',
      booking: 'الحجز',
      following: 'متابعة الأعمال',
      review: 'نشر المراجعات الموثقة',
    },
    profile: {
      title: 'الملف الشخصي',
      editProfile: 'تحرير الملف الشخصي',
      settings: 'الإعدادات',
      notifications: 'الإشعارات',
      language: 'اللغة',
      theme: 'المظهر',
      subscriptionPlan: 'خطة الاشتراك',
      documentVerification: 'التحقق من الوثائق',
      help: 'المساعدة والدعم',
      about: 'حول',
      termsOfService: 'شروط الخدمة',
      privacyPolicy: 'سياسة الخصوصية',
    },
    subscription: {
      title: 'خطط الاشتراك',
      free: 'مجاني',
      weekly: 'أسبوعي',
      monthly: 'شهري',
      yearly: 'سنوي',
      currentPlan: 'الخطة الحالية',
      upgrade: 'ترقية',
      choosePlan: 'اختر خطة',
      features: 'المميزات',
      unlimitedListings: 'قوائم غير محدودة',
      prioritySupport: 'دعم ذو أولوية',
      analyticsAccess: 'الوصول إلى التحليلات',
      boostListings: 'تعزيز القوائم',
    },
    notifications: {
      title: 'الإشعارات',
      bookingConfirmed: 'تم تأكيد الحجز',
      paymentReminder: 'تذكير بالدفع',
      ticketUpdate: 'تحديث التذكرة',
      rewardEarned: 'مكافأة مكتسبة',
      newMessage: 'رسالة جديدة',
      subscriptionExpiring: 'انتهاء صلاحية الاشتراك',
    },
    messages: {
      title: 'الرسائل',
      newMessage: 'رسالة جديدة',
      conversation: 'محادثة',
      typeMessage: 'اكتب رسالة...',
      send: 'إرسال',
      noMessages: 'لا توجد رسائل',
    },
  },
};

const i18n = new I18n(translations);

i18n.defaultLocale = 'en';
i18n.enableFallback = true;

const LANGUAGE_KEY = '@aura_language';

export async function getStoredLanguage(): Promise<string | null> {
  try {
    return await AsyncStorage.getItem(LANGUAGE_KEY);
  } catch (error) {
    console.error('Error loading language:', error);
    return null;
  }
}

export async function setStoredLanguage(language: string): Promise<void> {
  try {
    await AsyncStorage.setItem(LANGUAGE_KEY, language);
    i18n.locale = language;
  } catch (error) {
    console.error('Error saving language:', error);
  }
}

export async function initializeLanguage(): Promise<string> {
  const storedLanguage = await getStoredLanguage();
  
  if (storedLanguage) {
    i18n.locale = storedLanguage;
    return storedLanguage;
  }
  
  const deviceLanguage = Localization.getLocales()[0]?.languageCode || 'en';
  const supportedLanguages = ['en', 'sw', 'fr', 'ar'];
  const languageToUse = supportedLanguages.includes(deviceLanguage)
    ? deviceLanguage
    : 'en';
  
  i18n.locale = languageToUse;
  await setStoredLanguage(languageToUse);
  
  return languageToUse;
}

export function getCurrentLanguage(): string {
  return i18n.locale;
}

export function t(key: string, options?: any): string {
  return i18n.t(key, options);
}

export const supportedLanguages = [
  { code: 'en', name: 'English', nativeName: 'English' },
  { code: 'sw', name: 'Swahili', nativeName: 'Kiswahili' },
  { code: 'fr', name: 'French', nativeName: 'Français' },
  { code: 'ar', name: 'Arabic', nativeName: 'العربية' },
];

export default i18n;
